<!--
    Author: Amy Lin
    Hackbright Academy, Fall 2013

    Many thanks to:
        Leaflet JS + the amazing community for the various plugins
            Marker Cluster
            Heatmap JS
        Chart JS
        Cloudmade
        Google Fonts
-->

<html>
    <head>
        <title>Supplycache: Locating Resources in Your Community</title>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link rel="icon" type="image/ico" href="../static/img/favicon.ico"/>

        <script src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.9.1.js"></script>

        <link rel="stylesheet" href="../static/css/leaflet.css" />
        <script src="../static/js/leaflet-src.js"></script>
        <!-- Leaflet heatmap plugin -->
        <script type="text/javascript" src="../static/js/heatmap.js"></script>
        <script type="text/javascript" src="../static/js/heatmap-leaflet.js"></script>
        <script type="text/javascript" src="../static/js/QuadTree.js"></script>
        <!-- Leaflet marker cluster plugin -->
        <script src="../static/js/leaflet.markercluster-src.js"></script>
        <script src="../static/js/leaflet.markercluster.js"></script>
        <!-- Leaflet label plugin-->
        <script src="../static/js/leaflet.label.js"></script>
        
        <!-- CSS -->
        <link rel="stylesheet" type="text/css" href="../static/css/styles.css">
        <link rel="stylesheet" href="../static/css/leaflet.css">
        <link rel="stylesheet" href="../static/css/MarkerCluster.css">
        <link rel="stylesheet" href="../static/css/MarkerCluster.Default.css">

        <!-- Google Fonts -->
        <link href="http://fonts.googleapis.com/css?family=Arvo|Open+Sans:400,700" rel="stylesheet" type="text/css">

        <!-- Google Graphs JS -->
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>

        <!-- Chart JS -->
        <script src="../static/js/Chart.js"></script>

        <!-- Rickshaw JS -->
        <link type="text/css" rel="stylesheet" href="../static/css/graph.css">
        <link type="text/css" rel="stylesheet" href="../static/css/detail.css">
        <link type="text/css" rel="stylesheet" href="../static/css/legend.css">
        <link type="text/css" rel="stylesheet" href="../static/css/lines.css">
        <script src="../static/js/d3.v2.js"></script>
        <script src="../static/js/rickshaw.js"></script>

        <!-- Layout fluidity -->
        <script>
            $(document).ready(function() {
                var currHeight = $(window).height();
                $('#sidebar, #content').css('height', currHeight);
                $(window).resize(function() {
                    var currHeight = $(window).height();
                    $('#sidebar, #content').css('height', currHeight);
                });
            });
        </script>

        <script>
        $(function () {
            var baseLayer = L.tileLayer(
                'http://{s}.tile.cloudmade.com/38be25219f7c4b6f8953354a1b2e583f/82651/256/{z}/{x}/{y}.png', 
                {
                    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
                    maxZoom: 17
                }
            );
            // Heatmap JS
            var heatmapLayer = L.TileLayer.heatMap({
                // radius could be absolute or relative
                // absolute: radius in meters, relative: radius in pixels
                radius: { 
                    value: 500, 
                    absolute: true 
                },
                opacity: 0.65,
                gradient: {
                    0.45: "rgb(0,0,255)",
                    0.55: "rgb(0,255,255)",
                    0.65: "rgb(0,255,0)",
                    0.95: "yellow",
                    1.0: "rgb(255,0,0)"
                }
            });

            // Heatmap points
            var testData = {
                max: 31,
                data: [
                    {lat: 37.786827, lon:-122.490956, value: 2.75},
                    {lat: 37.791827, lon:-122.482956, value: 2},
                    {lat: 37.779399, lon:-122.454155, value: 1},
                    {lat: 37.773399, lon:-122.459155, value: 1.5},
                    {lat: 37.769399, lon:-122.454155, value: 1.5},
                    {lat: 37.769399, lon:-122.464155, value: 1.5},
                    {lat: 37.73, lon:-122.420338, value: 3.75},
                    {lat: 37.735, lon:-122.425338, value: 1.75},
                    {lat: 37.729, lon:-122.433338, value: 1.75}
                ]
            };
            heatmapLayer.setData(testData.data);

            var markerIcon = L.Icon.extend({
                options: {
                    shadowUrl: '../static/img/marker-shadow.png'
                }
            });
            var blueIcon = new markerIcon({
                iconUrl: '../static/img/marker-icon.png'
            });

            var markers = new L.MarkerClusterGroup();

            var map = new L.Map('map', {
                zoomControl: false,
                center: new L.LatLng(37.762573,-122.495365),
                zoom: 12,
                layers: [baseLayer, heatmapLayer]
            });
            new L.Control.Zoom({
                position: 'topright'
            }).addTo(map);

            // Plot coordinates from locations table
            var coordinates = {{ map_json | safe }};
            for (var i = 0; i < coordinates.length; i++) {
                var a = coordinates[i];
                var title = a[2];
                var marker = L.marker(new L.LatLng(a[0], a[1]), {
                    icon: blueIcon,
                    title: title
                });
                marker.bindPopup(
                    "<b>Name:</b> " + "name" + "<br>" + 
                    "<b>Email:</b> " + "email" + "<br>" + 
                    "<b>Phone:</b> " + "phone" + "<br>" + 
                    "<b>Address:</b> " + title + "<br>" + 
                    "<b>Supply:</b> " + "supply" + "<br>" +
                    "<b>Comment: </b>" + "comment"
                );
                markers.addLayer(marker);
            }
            map.addLayer(markers);

            layer = heatmapLayer;
        });
        </script>
    </head>

    <body>
        {% block body %}
        {% endblock %}
    </body>
</html>